<div ng-controller="MainCtrl as mainCtrl">
  <div ng-include="'nav.html'"></div>

  <div id="wrapper"
       class="toggled"
       ng-controller="DatasetsCtrl as datasetsCtrl">

    <div ng-controller="MetadataCtrl as metadataCtrl">

      <div class="overlay"></div>
      <section style="height: 100%" layout="row" flex="">

        <md-content flex="" layout-padding="">
          <div ng-include="'navProject.html'"></div>

          <div layout="column" layout-fill="" layout-align="top center">
            <div ng-show="mainCtrl.searchReturned !== ''">
              <div id="projectSearchResults">
                <div ng-include="'views/searchResult.html'"></div>
              </div>
            </div>

            <div class="content-wrapper" ng-controller="ProjectCtrl as projectCtrl" ng-show="mainCtrl.searchReturned === ''">
              <h3 id="projectBread" style="display: none; margin-top: -17px;"> {{projectCtrl.currentProject.projectName}} /{{datasetsCtrl.pathArray[0]}}</h3>

              <h3>
                <div class="col-lg-3" style="margin-top: -17px;">
                  <button class="btn btn-success" ng-click="datasetsCtrl.newDataSetModal()" dropdown-toggle type="button" id="newDataSet" aria-haspopup="true" aria-expanded="true">
                    Create New DataSet
                  </button>
                </div>
                <div class="col-lg-6" style="max-width: 550px; " >
                  <!--                  <div class="ibox float-e-margins">
                                      <div class="ibox-content" style="padding-left:0px; padding-right:0px;">
                                        <div class="file-manager">-->
                  <!--style="margin: 0px; font-weight: bold; color: #2e353d;"-->
                  Filter: 
                  <a ng-click="datasetsCtrl.shared = undefined; datasetsCtrl.status = undefined" class="file-control active">All</a>
                  <a ng-click="datasetsCtrl.shared = true; datasetsCtrl.status = true" class="file-control">Shared</a>
                  <a ng-click="datasetsCtrl.shared = false; datasetsCtrl.status = true" class="file-control">Exclusive</a>
                  <a ng-click="datasetsCtrl.shared = true; datasetsCtrl.status = false" class="file-control">Pending</a>
                </div>
                <div class="col-md-1 col-lg-1 pull-right" style="margin-top: -18px;">
                  <hamburger-toggle state="datasetsCtrl.tgState" class="hamburger-toggle"></hamburger-toggle>
                </div>
              </h3>


              <div class="ds-content col-lg-12" ng-class="{'sidenav-open': datasetsCtrl.tgState}" style="margin-top: 5px;">
                <div class="row row-no-margin-left" style="margin-top: 15px;">

                  <div class="col-lg-12">
                    <div ng-repeat="dataset in datasetsCtrl.files| filter:{shared:datasetsCtrl.shared, status: datasetsCtrl.status} | orderBy: 'name'">
                      <div ng-init="(iscollapsed$index) = true"
                           class="file-box"
                           context-menu
                           data-target="menu-{{ $index}}">
                        <div  class="file">
                          <div ng-click="projectCtrl.browseDataset(dataset)">
                            <a>
                              <span class="corner"></span>

                              <div class="icon">
                                <i class="glyphicon glyphicon-folder-open"></i>
                              </div>
                            </a>
                          </div>
                          <div class="file-name">
                            {{dataset.name}}
                            <br/>
                            <small><b>Owner: </b> {{dataset.owner}}</small>
                            <br/>
                            <button
                              style="font-size:15px;height:28px;color:white;padding-top: 3px; margin-left: 20px; margin-top: -40px;"
                              ng-click="datasetsCtrl.select($index, dataset); metadataCtrl.setMetadataTemplate(dataset)"
                              class="btn btn-info">
                              <i class="fa fa-search"></i>
                            </button>
                          </div>
                        </div>
                      </div>
                      <div class="dropdown position-fixed" id="menu-{{$index}}">
                        <ul class="dropdown-menu dropdown-amore">
                          <!--                        <li>
                                                    <a class="pointer"
                                                       role="menuitem"
                                                       tabindex="1"
                                                       ng-click="panel.highlight = true; datasetsCtrl.compress(dataset); $event.stopPropagation();">
                                                      <span><i class="fa fa-file-archive-o"></i>
                                                        Compress</span>
                                                    </a>
                                                  </li>-->
                          <li ng-show="projectCtrl.role == 'Data owner'">
                            <a class="pointer"
                               role="menuitem"
                               tabindex="2"
                               ng-click="datasetsCtrl.share(dataset.name)">
                              <span><i class="fa fa-share-alt"></i>
                                Share...</span>
                            </a>
                          </li>
                          <li>
                            <a class="pointer"
                               role="menuitem"
                               tabindex="3"
                               ng-click="metadataCtrl.attachTemplate(dataset); $event.stopPropagation();">
                              <span><i class="fa fa-upload"></i>
                                Add metadata template</span>
                            </a>
                          </li>
                          <li>
                            <a class="pointer"
                               role="menuitem"
                               tabindex="4"
                               ng-click="metadataCtrl.detachTemplate(dataset); $event.stopPropagation();">
                              <span><i class="fa fa-download"></i>
                                Remove metadata template</span>
                            </a>
                          </li>
                          <li ng-show="projectCtrl.role == 'Data owner'">
                            <a class="pointer"
                               role="menuitem"
                               tabindex="5"
                               ng-click="datasetsCtrl.deleteFile(dataset.name)">
                              <span><i class="fa fa-trash"></i>
                                Remove</span>
                            </a>
                          </li>
                        </ul>
                      </div>
                    </div> <!-- end repeat -->

                    <div ng-init="(iscollapsed$index) = true"
                         ng-show="datasetsCtrl.files.length < 20"
                         class="file-box"
                         context-menu
                         data-target="menu-{{ $index}}">
                      <div  class="file" ng-click="datasetsCtrl.newDataSetModal()">
                        <div class="icon">
                          <i class="glyphicon glyphicon-plus"></i>
                        </div>
                        <div style="text-align: center; color: green;">
                          Create New DataSet
                        </div>
                      </div>
                    </div>                  


                  </div>
                </div>
              </div>
            </div> <!--content wrapper -->
          </div>
          <div flex=""></div>
        </md-content>

        <!--<div class="col-lg-4" style="border-left: 1px dashed lightgrey; padding-left: 0px;">-->
        <div class="ds-sidenav" ng-class="{open: datasetsCtrl.tgState}">
          <div class="ibox float-e-margins" style="margin-bottom: -25px; height: 95%;">
            <div class="file-manager">
              <div>
                <md-content class="md-padding" style="padding-top: 0px; min-width: 300px;">
                  <md-tabs md-dynamic-height md-border-bottom>
                    <md-tab label="Details">
                      <md-content>
                        <table id="mytable1" ng-show="datasetsCtrl.selected > -1 && datasetsCtrl.selected != undefined" class="table table-bordred table-striped" style="margin-top: 16px;">

                          <tr style="background-color: #fafafa">
                            <td style="color:lightgrey;">Description</td>
                            <td style="color: grey;">{{datasetsCtrl.fileDetail
                                                  .description}}</td>
                          </tr>

                          <tr style="background-color: #fafafa">
                            <td style="color:lightgrey;">Last modified</td>
                            <td style="color: grey;">{{datasetsCtrl.fileDetail.modification| date:'short'}}</td>
                          </tr>

                          <tr style="background-color: #fafafa">
                            <td style="color:lightgrey;">Owner</td>
                            <td style="color: grey;">{{datasetsCtrl.fileDetail.owner}}</td>
                          </tr>
                          <tr style="background-color: #fafafa">
                            <td style="color:lightgrey;">Permission</td>
                            <td style="color: grey;">{{datasetsCtrl.fileDetail.permission}}</td>
                          </tr>
                        </table>

                      </md-content>
                    </md-tab>
                  </md-tabs>
                </md-content>
              </div>
            </div>
          </div>
        </div>

      </section>
    </div>
  </div>
</div>