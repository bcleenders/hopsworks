<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"  
      xmlns:f="http://java.sun.com/jsf/core" 
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"

      xmlns:c="http://java.sun.com/jsp/jstl/core">
    <body>
        <ui:composition>
            <h:panelGrid columns="2">
                <p:panel styleClass="historyPanel" header="History">
                    <ui:insert name="history">
                        <ui:include src="/bbc/lims/studyTabs/HistoryPanel.xhtml">
                            <ui:param name="type" value="CUNEIFORM" />
                        </ui:include>
                    </ui:insert>
                </p:panel>
                <h:form id="cuneiForm">
                    <p:growl autoUpdate="true" showDetail="true"/>
                    <div class="workflow-head">
                        <div>
                            <h:panelGrid columns="1">
                                <span>
                                    <h:outputLabel value="Upload workflow file"/>
                                </span>
                                <p:fileUpload required="true" auto="true" multiple="false" 
                                              label="Select" mode="advanced" allowTypes="/(\.|\/)(cf)$/" 
                                              fileUploadListener="#{cuneiformController.workflowUpload}" 
                                              update="@form"/>
                                <h:outputLabel value="#{cuneiformController.workflowName}"/>
                            </h:panelGrid>
                        </div>

                        <h:graphicImage id="loadImg" class="browser s16" library="images/icons" name="ajax-loader.gif" style="display:none" />

                        <div>
                            <h:panelGrid columns="2" rendered="#{cuneiformController.workflowUploaded}">
                                <ui:repeat value="#{cuneiformController.freeVars}" var="variable">
                                    <h:inputText value="#{variable.name}" readonly="true"/>
                                    <h:inputText value="#{variable.value}"/>
                                </ui:repeat>
                            </h:panelGrid>
                        </div>

                        <div>
                            <p:commandButton value="Execute" action="#{cuneiformController.startWorkflow()}"/>
                        </div>
                    </div>
<!--                    <p:poll interval="300" listener="#{cuneiformController.jobFinished}" update="image" rendered="#{cuneiformController.started}"/>
                    <h:panelGroup id="image">
                        <h:graphicImage library="images" name="ajax-loader.GIF" rendered="#{not cuneiformController.jobFinished}"/>
                        <h:outputText value="FINISHED!!!" rendered="#{cuneiformController.jobFinished}"/>
                    </h:panelGroup>-->
                </h:form>
            </h:panelGrid>
        </ui:composition>
    </body>
</html>