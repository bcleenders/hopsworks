<?xml version="1.0" encoding="UTF-8"?>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"  
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui" 
      xmlns:f="http://java.sun.com/jsf/core"
      >
    <body>
        <ui:composition>
            <h3 class="page_title" align="left">
                Team Members (#{studyManagedBean.countAllMembersPerStudy()})
                <span class="right_button">
                    <h:form id="frmBtn">
                        <h:commandButton id="addTeam" class="button-add button-add-team" value="New Member" type="submit" action="newTeamMemb" rendered="#{studyManagedBean.renderComponentList() == 'Master'}"/>
                    </h:form>
                </span>
            </h3>
            <hr/>
            <div class="clear_fixing"></div>
            <h:form id="teamForm">
                <div id="divTeam" class="team_table"> 
                    <!-- Loop over all member groups -->
                    <ui:repeat value="#{studyManagedBean.groupedMembers}" var="memGroup">
                        <h:panelGroup id="div_#{memGroup.groupname}" styleClass="ui_box">
                            <!-- Display role name and number of members in that group -->
                            <h5 class="title" align="left">#{memGroup.groupname}
                                <small>#{studyManagedBean.countRoleUsers(memGroup.groupname)}</small>
                            </h5>
                            <ul class="well-list">
                                <!-- Loop over all users in this group-->
                                <ui:repeat value="#{memGroup.members}" var="usr" varStatus="usrStat">
                                    <li id="team_member_row_#{usrStat.count}" class="team_member_row">
                                        <div class="row">
                                            <div class="span6">
                                                <img class="avatar s36" src="#{activityBean.getGravatar(usr.email,36)}"/>
                                                <p:commandLink styleClass="dark">
                                                    <strong>#{usr.name}</strong>
                                                    <br/>
                                                    <small class="cgray">
                                                        #{usr.email}
                                                    </small>
                                                </p:commandLink>
                                            </div>
                                            <div class="span5 right">
                                                <div class="left">
                                                    <div id="frmStudyMaster_${usrStat.count}" class="edit_team_members"> 
                                                        <div style="margin:0;padding:0;display:inline">
                                                            <p:selectOneMenu id="list_#{memGroup.groupname}_#{usrStat.count}" value="#{valueChangeMB.newTeamRole}" styleClass="study_role_assign" disabled="#{studyManagedBean.studyOwnedBy(usr.email)}" 
                                                                             style="width:170px;" rendered="#{studyManagedBean.renderComponentList() == 'Master'}">
                                                                <f:ajax execute="@form" render="@form" listener="#{valueChangeMB.updateStudyTeamRole(usr.email)}"/>
                                                                <f:selectItems value="#{studyManagedBean.getStudyRolesForCurrentRole(memGroup.groupname)}" var="ms" itemLabel="#{ms.team}" itemValue="#{ms}"/>
                                                            </p:selectOneMenu>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="right" align="right">
                                                    <h:commandButton class="btn" value="This is you!" disabled="true" rendered="#{studyManagedBean.username eq usr.email}"/>
                                                    <h:commandButton class="button-success" value="Owner" disabled="true" rendered="#{studyManagedBean.studyOwnedBy(usr.email)}"/>
<!--                                                    <p:commandLink styleClass="ui-button fa fa-minus"  value="" action="#{valueChangeMB.deleteMemberFromTeam(mlist.email)}" rendered="#{studyManagedBean.renderComponentList() == 'Master'}" update="@form">
                                                        <p:confirm header="Removing a team member" message="Are you sure you want to remove #{mlist.name} [#{mlist.email}]?" icon="ui-icon-alert"/>
                                                    </p:commandLink>
                                                    <p:confirmDialog id="currentUser_master_${mst.count}" global="true" severity="alert" showEffect="fade"> 
                                                        <p:commandButton value="Yes" icon="ui-icon-check" styleClass="ui-confirmdialog-yes" type="submit" update="teamForm"/>   
                                                        <p:commandButton value="No"  icon="ui-icon-close" styleClass="ui-confirmdialog-no" type="button"/> 
                                                    </p:confirmDialog> -->
                                                </div>
                                            </div>
                                        </div>
                                    </li>
                                </ui:repeat>
                            </ul>
                        </h:panelGroup>
                    </ui:repeat>
                </div>
            </h:form>
        </ui:composition>
    </body>
</html>
