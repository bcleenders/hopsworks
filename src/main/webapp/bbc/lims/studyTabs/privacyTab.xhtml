<?xml version="1.0" encoding="UTF-8"?>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"  
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://java.sun.com/jsf/core"
      >
    <body>

        <p:growl id="growl" life="2000" severity="error,info" showDetail="true" autoUpdate="true"/>

        <h:form id="privacy">
            <p:panelMenu>
                <p:submenu   style="padding-bottom: 10px;" label="Consent and Ethical Approval">
                    <p:menuitem value=""
                                ajax="false" 
                                icon="ui-icon-close">
                        <p:panelGrid columns="4" >         

                            <p:column>    
                                Consent Status: #{studyManagedBean.activeConent.status}
                            </p:column>

                            <p:column>
                                Retention Period: #{studyManagedBean.retentionPeriod}
                            </p:column>

                            <p:column>
                                <p:calendar id="cal" value="#{studyManagedBean.retentionPeriod}"  showOn="button" >

                                </p:calendar>  
                            </p:column>
                            <p:column>
                                <p:commandButton  value="Update Period"  
                                                  update="privacy"
                                                  action="#{studyManagedBean.updateRetentionPeriod()}"
                                                  rendered="#{studyManagedBean.renderComponentList() == 'Master'}"/>
                            </p:column>

                        </p:panelGrid>
                
                        <p:dataGrid 
                            value="#{studyManagedBean.allConsent}"
                            var="consent"
                             >
                            
                            <f:facet name="header" >Consent and Ethical Approval </f:facet>
   
                            <p:column>
                                <h:commandLink  action="#{studyManagedBean.showConsent(consent.name)}" 
                                                    target="_blank"
                                                    style="float:left;margin-right:10px">
                                    
                                <h:graphicImage  library="images/icons" 
                                                     name="consent.png" 
                                                     width="30"
                                                     height="30"/>
                                </h:commandLink>
                            </p:column>
                            
                            <p:column>
                                    <h:outputLabel value="#{consent.name}" />
                                
                            </p:column>
                        </p:dataGrid>
                        
                        
                        <h:panelGrid columns="3" style="padding-top: 80px;">
                        <p:fileUpload value="#{fileSelectionController.selectedPath}" 
                                        auto="true" 
                                      multiple="false"
                                      label="Upload Consent Form" 
                                      oncomplete="PF('chooseFileDlg').hide()"
                                      mode="advanced" 
                                       rendered="#{studyManagedBean.renderComponentList() == 'Master'}"
                                       />
                        
                         
                        <p:fileUpload value="#{fileSelectionController.selectedPath}" 
                                        auto="true" 
                                      multiple="false"
                                      label="Upload Ethical Approval"
                                      oncomplete="PF('chooseFileDlg').hide()"
                                      mode="advanced" 
                                       rendered="#{studyManagedBean.renderComponentList() == 'Master'}"
                                       />
                           
                        
                        <p:fileUpload value="#{fileSelectionController.selectedPath}" 
                                        auto="true" 
                                      multiple="false"
                                      label="Upload Amendment"
                                      oncomplete="PF('chooseFileDlg').hide()"
                                      mode="advanced" 
                                       rendered="#{studyManagedBean.renderComponentList() == 'Master'}"
                                       />
                         
                        </h:panelGrid>
                   
                    </p:menuitem>
                </p:submenu>
            </p:panelMenu>

        </h:form>

        
        <h:form id="audit">
            <p:dataTable var="user"
                         value="#{studyManagedBean.allActivities}" 
                         emptyMessage="No audit logs"
                         scrollable="true">

                <f:facet name="header" >Audit </f:facet>

                <p:column id="lnameColumn" filterBy="#{user.performedByName}"
                          headerText="Name"
                          style="width:32%; font-size: 12px; text-align: left;">

                    <h:outputText value="#{user.performedByName}" />
                </p:column>

                <p:column id="emailColumn" filterBy="#{user.performedByEmail}"
                          headerText="Email" 
                          style="width:32%;font-size: 12px;text-align: left;">
                    <h:outputText value="#{user.performedByEmail}" />
                </p:column>


                <p:column  filterBy="#{user.timestamp}"
                           headerText="Action Date" 
                           style="width:32%;font-size: 12px;text-align: left;">
                    <h:outputText value="#{user.timestamp}"/>
                </p:column>

                <p:column  filterBy="#{user.description}"
                           headerText="Action" 
                           style="width:32%;font-size: 12px;text-align: left;">
                    <h:outputText value="#{user.description}"/>
                </p:column>
            </p:dataTable>
        </h:form>


    </body>
</html> 