<?xml version="1.0" encoding="UTF-8"?>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"  
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://java.sun.com/jsf/core"
      >
    <body>

        <p:growl id="growl" life="2000" severity="error,info" showDetail="true" autoUpdate="true"/>

        <h:form id="privacy">
            <p:panelMenu>
                <p:submenu   style="padding-bottom: 10px;" label="Consent and Ethical Approval">
                    <p:menuitem value=""
                                ajax="false" 
                                icon="ui-icon-close">


                        <p:panelGrid columns="4">         

                            <p:column>    
                                Consent Status: #{studyPrivacyManager.getConsentStatus(studyManagedBean.studyName)}
                            </p:column>

                            <p:column>
                                Retention Period: #{studyPrivacyManager.getRetentionPeriod(studyManagedBean.studyName)}
                            </p:column>
                            
                            <p:column>
                                Update 
                            </p:column>
                            <p:column>
                                <p:commandButton  value="Update Period"  
                                                  action="#{studyPrivacyManager.updateRetentionPeriod(studyManagedBean.studyName)}"
                                                  rendered="#{studyManagedBean.renderComponentList() == 'Master'}"/>
                            </p:column>
                            
                        </p:panelGrid>
                        
                        
                        <h:panelGrid columns="2">
                            <h:graphicImage  library="images/icons" name="consent.png" width="50" height="50"/>
                            <h:outputText value="#{studyManagedBean.studyName}" 
                                          style="float: right" />
                        </h:panelGrid>

                        
                            <p:commandButton value="View Consent"
                                             action="#{studyPrivacyManager.showConsent(studyManagedBean.studyName)}"
                                             id="imageBtn"
                                             type="button"
                                             rendered="#{studyManagedBean.renderComponentList() == 'Master'}">
                                <p:lightBox styleClass="imagebox" id="lighbox1">
                                    <p:graphicImage library="images" name="consent.gif" width="300" />
                                </p:lightBox>
                            </p:commandButton>


                            <p:commandButton value="Upload Consent" action="#{studyManagedBean.uploadConsent()}"
                                             rendered="#{studyManagedBean.renderComponentList() == 'Master'}"/>
                            
                            <p:commandButton value="Renew Consent" type="button"
                                             rendered="#{studyManagedBean.renderComponentList() == 'Master'}"/>

                            <p:commandButton value="Upload Ethical Approval" type="button"
                                             rendered="#{studyManagedBean.renderComponentList() == 'Master'}"/>

                            <p:commandButton value="Upload Amendment" type="button"
                                             rendered="#{studyManagedBean.renderComponentList() == 'Master'}"/>

                            
                    </p:menuitem>
                </p:submenu>
            </p:panelMenu>
        </h:form>    

        <h:form id="audit">
            <p:dataTable var="user"
                         value="#{studyPrivacyManager.getAllActivities(studyManagedBean.studyName)}" 
                         rowKey="#{user.performedByEmail}"
                         emptyMessage="No audit logs"
                         scrollable="true">

                <f:facet name="header" >Audit </f:facet>

                <p:column id="lnameColumn" filterBy="#{user.performedByName}"
                          headerText="Name"
                          style="width:32%; font-size: 12px; text-align: left;">

                <h:outputText value="#{user.performedByName}" />
                </p:column>

                <p:column id="emailColumn" filterBy="#{user.performedByEmail}"
                          headerText="Email" 
                          style="width:32%;font-size: 12px;text-align: left;">
                <h:outputText value="#{user.performedByEmail}" />
                </p:column>


                <p:column  filterBy="#{user.timestamp}"
                           headerText="Action Date" 
                           style="width:32%;font-size: 12px;text-align: left;">
                <h:outputText value="#{user.timestamp}"/>
                </p:column>

                <p:column  filterBy="#{user.description}"
                           headerText="Action" 
                           style="width:32%;font-size: 12px;text-align: left;">
                <h:outputText value="#{user.description}"/>
                </p:column>
            </p:dataTable>
        </h:form>
    </body>
</html> 