<?xml version="1.0" encoding="UTF-8"?>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"  
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:c="http://java.sun.com/jsp/jstl/core"  
      xmlns:f="http://java.sun.com/jsf/core"
      >
    <body>
        <ui:composition>
            <h3 class="page_title" align="left">
                Team Members (#{studyManagedBean.countAllMembersPerStudy()})
                <span class="right_button">
                    <h:form id="frmBtn">
                        <h:commandButton id="addTeam" class="button-add button-add-team" value="New Member" type="submit" action="newTeamMemb" rendered="#{studyManagedBean.renderComponentList() == 'Master'}"/>
                    </h:form>
                </span>
            </h3>
            <hr/>
            <div class="clear_fixing"></div>
            <h:form id="teamForm">
            <div id="divTeam" class="team_table"> 
                <c:if id="masterBlock" test="${studyManagedBean.countMasters() > 0}">
                    <!-- There are Masters registered for this study: display them -->
                    <h:panelGroup id="divMaster" styleClass="ui_box">
                        <h5 class="title" align="left">Masters
                            <small>#{studyManagedBean.countMasters()}</small></h5>
                        <ul class="well-list">
                            <c:forEach var="mlist" items="${studyManagedBean.mastersList}" varStatus="mst">
                                <c:if id="ownerOnly_master" test="${(studyManagedBean.checkStudyOwner(mlist.email) eq mlist.email) and (studyManagedBean.checkCurrentUser(mlist.email) ne mlist.email)}">
                                    <li id="team_member_row_${mst.count}" class="team_member_row">
                                        <div class="row">
                                            <div class="span6">
                                                <img class="avatar s36" src="#{activityBean.getGravatar(mlist.email,36)}"/>
                                                <p:commandLink styleClass="dark">
                                                    <strong>#{mlist.name}</strong>
                                                    <br/>
                                                    <small class="cgray">
                                                        #{mlist.email}
                                                    </small>
                                                </p:commandLink>
                                            </div>
                                            <div class="span5 right">
                                                <div class="left">
                                                    <div id="frmStudyMaster_${mst.count}" class="edit_team_members"> 
                                                        <div style="margin:0;padding:0;display:inline">
                                                            <p:selectOneMenu id="Owner" value="#{valueChangeMB.newTeamRole}" styleClass="study_role_assign" disabled="true" 
                                                                             style="width:170px;" rendered="#{studyManagedBean.renderComponentList() == 'Master'}">
                                                                <f:selectItems value="#{studyManagedBean.team}" var="ms" itemLabel="#{ms.team}" itemValue="#{ms}"/>
                                                                <!--                                                                                     <f:selectItem itemLabel="Master" itemValue="Master"/>
                                                                                                                                                     <f:selectItem itemLabel="Researcher" itemValue="Researcher"/>
                                                                                                                                                     <f:selectItem itemLabel="Guest" itemValue="Guest"/>-->
                                                            </p:selectOneMenu>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="right" align="right">
                                                    <h:commandButton class="button-success" value="Owner" disabled="true"/>
                                                </div>
                                            </div>
                                        </div>
                                    </li>
                                </c:if>
                                <c:if id="currentUser_master" test="${(studyManagedBean.checkStudyOwner(mlist.email) ne mlist.email) and (studyManagedBean.checkCurrentUser(mlist.email) eq mlist.email)}">
                                    <li id="team_member_row_${mst.count}" class="team_member_row">
                                        <div class="row">
                                            <div class="span6">
                                                <img class="avatar s36" src="#{activityBean.getGravatar(mlist.email,36)}"/>
                                                <p:commandLink styleClass="dark">
                                                    <strong>#{mlist.name}</strong>
                                                    <br/>
                                                    <small class="cgray">
                                                        #{mlist.email}
                                                    </small>
                                                </p:commandLink>
                                            </div>
                                            <div class="span5 right">
                                                <div class="left">
                                                    <div id="frmMaster_${mst.count}" class="edit_team_members"> 
                                                        <div style="margin:0;padding:0;display:inline">
                                                            <p:selectOneMenu id="masterList_${mst.count}" value="#{valueChangeMB.newTeamRole}" styleClass="study_role_assign"  
                                                                             style="width:170px;" rendered="#{studyManagedBean.renderComponentList() == 'Master'}">
                                                                <p:ajax update="@form" listener="#{valueChangeMB.updateStudyTeamRole(mlist.email)}"/>
                                                                <f:selectItems value="#{studyManagedBean.team}" var="ms" itemLabel="#{ms.team}" itemValue="#{ms}"/>
                                                                <!--                                                                                                <f:selectItem itemLabel="Master" itemValue="Master"/>
                                                                                                                                                                <f:selectItem itemLabel="Researcher" itemValue="Researcher"/>
                                                                                                                                                                <f:selectItem itemLabel="Guest" itemValue="Guest"/>-->
                                                            </p:selectOneMenu>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="right" align="right">
                                                    <h:commandButton class="btn" value="This is you!" disabled="true"/>
                                                    <p:commandLink styleClass="ui-button fa fa-minus"  value="" action="#{valueChangeMB.deleteMemberFromTeam(mlist.email)}" rendered="#{studyManagedBean.renderComponentList() == 'Master'}" update="@form">
                                                        <p:confirm header="Removing a team member" message="Are you sure you want to remove #{mlist.name} [#{mlist.email}]?" icon="ui-icon-alert"/>
                                                    </p:commandLink>
                                                    <p:confirmDialog id="currentUser_master_${mst.count}" global="true" severity="alert" showEffect="fade"> 
                                                        <p:commandButton value="Yes" icon="ui-icon-check" styleClass="ui-confirmdialog-yes" type="submit" update="teamForm"/>   
                                                        <p:commandButton value="No"  icon="ui-icon-close" styleClass="ui-confirmdialog-no" type="button"/> 
                                                    </p:confirmDialog> 
                                                </div>
                                            </div>
                                        </div>
                                    </li>
                                </c:if>
                                <c:if id="ownerNcurrentUser_master" test="${(studyManagedBean.checkStudyOwner(mlist.email) eq mlist.email) and (studyManagedBean.checkCurrentUser(mlist.email) eq mlist.email)}">
                                    <li id="team_member_row_${mst.count}" class="team_member_row">
                                        <div class="row">
                                            <div class="span6">
                                                <img class="avatar s36" src="#{activityBean.getGravatar(mlist.email,36)}"/>
                                                <p:commandLink styleClass="dark">
                                                    <strong>#{mlist.name}</strong>
                                                    <br/>
                                                    <small class="cgray">
                                                        #{mlist.email}
                                                    </small>
                                                </p:commandLink>
                                            </div>
                                            <div class="span5 right">
                                                <div class="left">
                                                    <div id="frmMaster_${mst.count}" class="edit_team_members">
                                                        <div style="margin:0;padding:0;display:inline">
                                                            <p:selectOneMenu id="masterList_${mst.count}" value="#{valueChangeMB.newTeamRole}" styleClass="study_role_assign"  style="width:170px;"
                                                                             disabled="true" rendered="#{studyManagedBean.renderComponentList() == 'Master'}">
                                                                <p:ajax update="@form" listener="#{valueChangeMB.updateStudyTeamRole(mlist.email)}"/>
                                                                <f:selectItems value="#{studyManagedBean.team}" var="ms" itemLabel="#{ms.team}" itemValue="#{ms}"/>
                                                                <!--                                                                                                <f:selectItem itemLabel="Master" itemValue="Master"/>
                                                                                                                                                                <f:selectItem itemLabel="Researcher" itemValue="Researcher"/>
                                                                                                                                                                <f:selectItem itemLabel="Guest" itemValue="Guest"/>-->
                                                            </p:selectOneMenu>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="right" align="right">
                                                    <h:commandButton class="btn" value="This is you!" disabled="true"/>
                                                    <h:commandButton class="button-success" value="Owner" disabled="true"/>
                                                </div>
                                            </div>
                                        </div>
                                    </li>
                                </c:if>
                                <c:if id="notCurrentUserNOwner_master" test="${studyManagedBean.checkStudyOwner(mlist.email) ne mlist.email and (studyManagedBean.checkCurrentUser(mlist.email) ne mlist.email)}">
                                    <li id="team_member_row_${mst.count}" class="team_member_row">
                                        <div class="row">
                                            <div class="span6">
                                                <img class="avatar s36" src="#{activityBean.getGravatar(mlist.email,36)}"/>
                                                <p:commandLink styleClass="dark">
                                                    <strong>#{mlist.name}</strong>
                                                    <br/>
                                                    <small class="cgray">
                                                        #{mlist.email}
                                                    </small>
                                                </p:commandLink>
                                            </div>
                                            <div class="span5 right">
                                                <div class="left">
                                                    <div id="frmMaster_${mst.count}" class="edit_team_members">
                                                        <div style="margin:0;padding:0;display:inline">
                                                            <p:selectOneMenu id="masterList_${mst.count}" value="#{valueChangeMB.newTeamRole}" styleClass="study_role_assign" 
                                                                             style="width:170px;" rendered="#{studyManagedBean.renderComponentList() == 'Master'}">
                                                                <p:ajax update="@form" listener="#{valueChangeMB.updateStudyTeamRole(mlist.email)}"/>
                                                                <f:selectItems value="#{studyManagedBean.team}" var="ms" itemLabel="#{ms.team}" itemValue="#{ms}"/>
                                                                <!--                                                                                                <f:selectItem itemLabel="Master" itemValue="Master"/>
                                                                                                                                                                <f:selectItem itemLabel="Researcher" itemValue="Researcher"/>
                                                                                                                                                                <f:selectItem itemLabel="Guest" itemValue="Guest"/>-->
                                                            </p:selectOneMenu>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="right" align="right">
                                                    <p:commandLink styleClass="ui-button fa fa-minus"  value="" action="#{valueChangeMB.deleteMemberFromTeam(mlist.email)}" rendered="#{studyManagedBean.renderComponentList() == 'Master'}" update="@form">
                                                        <p:confirm header="Removing a team member" message="Are you sure you want to remove #{mlist.name} [#{mlist.email}]?" icon="ui-icon-alert"/>
                                                    </p:commandLink>
                                                    <p:confirmDialog id="notCurrentUserNOwner_master_${mst.count}" global="true" severity="alert" showEffect="fade"> 
                                                        <p:commandButton value="Yes" icon="ui-icon-check" styleClass="ui-confirmdialog-yes" type="submit" update="teamForm"/>   
                                                        <p:commandButton value="No"  icon="ui-icon-close" styleClass="ui-confirmdialog-no" type="button"/>   
                                                    </p:confirmDialog> 
                                                </div>
                                            </div>
                                        </div>
                                    </li>
                                </c:if>
                            </c:forEach>
                        </ul>
                    </h:panelGroup>
                </c:if>
                <!-- End of Master Panel Group and starting of Researcher Panel Group-->   

                <c:if id="researcherBlock"  test="${studyManagedBean.countResearchers() > 0}">
                    <h:panelGroup id="divRech" styleClass="ui_box">
                        <h5 class="title" align="left">Researchers
                            <small>#{studyManagedBean.countResearchers()}</small></h5>

                        <ul class="well-list">
                            <c:forEach var="rlist" items="${studyManagedBean.researchersList}" varStatus="rchs">
                                <c:if id="notCurrentUser_researcher" test="${studyManagedBean.checkCurrentUser(rlist.email) ne rlist.email}">
                                    <li id="researchers_${rchs.count}" class="team_member_row">
                                        <div id="divRow" class="row">
                                            <div class="span6">
                                                <img class="avatar s36" src="#{activityBean.getGravatar(rlist.email,36)}"/>
                                                <p:commandLink styleClass="dark">
                                                    <strong>#{rlist.name}</strong>
                                                    <br/>
                                                    <small class="cgray">
                                                        #{rlist.email}
                                                    </small>
                                                </p:commandLink>
                                            </div>
                                            <div id="userBlock" class="span5 right">
                                                <div class="left">
                                                    <div id="frmRchs_${rchs.count}" class="edit_team_members">
                                                        <div style="margin:0;padding:0;display:inline">
                                                            <p:selectOneMenu id="researcherList_${rchs.count}" value="#{valueChangeMB.newTeamRole}" 
                                                                             styleClass="study_role_assign"  style="width:170px;" rendered="#{studyManagedBean.renderComponentList() == 'Master'}">
                                                                <p:ajax update="@form" listener="#{valueChangeMB.updateStudyTeamRole(rlist.email)}"/>
                                                                <!--                                                                            <f:selectItem itemLabel="Researcher"/>-->
                                                                <f:selectItems value="#{studyManagedBean.getListBasedOnCurrentRole(rlist.email)}" var="rc" itemLabel="#{rc.team}" itemValue="#{rc}"/>
<!--                                                                                           rendered="#{studyManagedBean.getCurrentRole(rlist.email)== 'Researcher'}"/>-->
                                                                <!--                                                                                  <f:selectItem itemLabel="Researcher" itemValue="Researcher"/>
                                                                                                                                                  <f:selectItem itemLabel="Master" itemValue="Master"/>
                                                                                                                                                  <f:selectItem itemLabel="Guest" itemValue="Guest"/>-->
                                                            </p:selectOneMenu>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="right" align="right">
                                                    <p:commandLink styleClass="ui-button fa fa-minus"  value="" action="#{valueChangeMB.deleteMemberFromTeam(rlist.email)}" rendered="#{studyManagedBean.renderComponentList() == 'Master'}" update="@form">
                                                        <p:confirm header="Removing a team member" message="Are you sure you want to remove #{rlist.name} [#{rlist.email}]?" icon="ui-icon-alert"/>
                                                    </p:commandLink>
                                                    <p:confirmDialog id="notCurrentUser_researcher_${rchs.count}"  global="true" severity="alert" showEffect="fade"> 
                                                        <p:commandButton value="Yes" icon="ui-icon-check" styleClass="ui-confirmdialog-yes" type="submit" update="teamForm"/>   
                                                        <p:commandButton value="No"  icon="ui-icon-close" styleClass="ui-confirmdialog-no" type="button"/>   
                                                    </p:confirmDialog>
                                                </div>
                                            </div>
                                        </div> 
                                    </li>
                                </c:if> 
                                <c:if id="currentUser_researcher" test="${studyManagedBean.checkCurrentUser(rlist.email) eq rlist.email}">
                                    <li id="researchers_${rchs.count}" class="team_member_row">
                                        <div id="divRow" class="row">
                                            <div class="span6">
                                                <img class="avatar s36" src="#{activityBean.getGravatar(rlist.email,36)}"/>
                                                <p:commandLink styleClass="dark">
                                                    <strong>#{rlist.name}</strong>
                                                    <br/>
                                                    <small class="cgray">
                                                        #{rlist.email}
                                                    </small>
                                                </p:commandLink>
                                            </div>
                                            <div id="userBlock" class="span5 right">
                                                <div class="left">
                                                    <div id="frmRchs_${rchs.count}" class="edit_team_members">
                                                        <div style="margin:0;padding:0;display:inline">
                                                            <p:selectOneMenu id="researcherList_${rchs.count}" value="#{valueChangeMB.newTeamRole}" 
                                                                             styleClass="study_role_assign"  style="width:170px;" rendered="#{studyManagedBean.renderComponentList() == 'Master'}">
                                                                <p:ajax update="@form" listener="#{valueChangeMB.updateStudyTeamRole(rlist.email)}"/>
                                                                <!--                                                                            <f:selectItem itemLabel="Researcher"/>-->
                                                                <f:selectItems value="#{studyManagedBean.getListBasedOnCurrentRole(rlist.email)}" var="rc" itemLabel="#{rc.team}" itemValue="#{rc}"/>
<!--                                                                                           rendered="#{studyManagedBean.getCurrentRole(rlist.email)== 'Researcher'}"/>-->
                                                                <!--                                                                                  <f:selectItem itemLabel="Researcher" itemValue="Researcher"/>
                                                                                                                                                  <f:selectItem itemLabel="Master" itemValue="Master"/>
                                                                                                                                                  <f:selectItem itemLabel="Guest" itemValue="Guest"/>-->
                                                            </p:selectOneMenu>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="right" align="right">
                                                    <h:commandButton class="btn" value="This is you!" disabled="true"/>
                                                    <p:commandLink styleClass="ui-button fa fa-minus"  value="" action="#{valueChangeMB.deleteMemberFromTeam(rlist.email)}" rendered="#{studyManagedBean.renderComponentList() == 'Master'}" update="@form">
                                                        <p:confirm header="Removing a team member" message="Are you sure you want to remove #{rlist.name} [#{rlist.email}]?" icon="ui-icon-alert"/>
                                                    </p:commandLink>
                                                    <p:confirmDialog id="currentUser_researcher_${rchs.count}" global="true" severity="alert" showEffect="fade"> 
                                                        <p:commandButton value="Yes" icon="ui-icon-check" styleClass="ui-confirmdialog-yes" type="submit" update="teamForm"/>   
                                                        <p:commandButton value="No"  icon="ui-icon-close" styleClass="ui-confirmdialog-no" type="button"/>   
                                                    </p:confirmDialog> 
                                                </div>
                                            </div>
                                        </div> 
                                    </li>
                                </c:if> 
                            </c:forEach>
                        </ul>
                    </h:panelGroup>
                </c:if>
                <c:if id="auditorBlock" test="${studyManagedBean.countAuditors() > 0}">
                    <h:panelGroup id="divAud" styleClass="ui_box">
                        <h5 class="title" align="left">Auditors
                            <small>#{studyManagedBean.countAuditors()}</small></h5>
                        <ul class="well-list">
                            <c:forEach var="alist" items="${studyManagedBean.auditorsList}" varStatus="aud">
                                <c:if id="notCurrentUser_guest" test="${studyManagedBean.checkCurrentUser(alist.email) ne alist.email}">
                                    <li id="guests_${aud.count}" class="team_member_row">
                                        <div class="row">
                                            <div class="span6">
                                                <img class="avatar s36" src="#{activityBean.getGravatar(alist.email,36)}"/>
                                                <p:commandLink styleClass="dark">
                                                    <strong>#{alist.name}</strong>
                                                    <br/>
                                                    <small class="cgray">
                                                        #{alist.email}
                                                    </small>
                                                </p:commandLink>
                                            </div> 
                                            <div class="span5 right"> 

                                                <div class="left">
                                                    <div id="frmGuest_${aud.count}" class="edit_team_members">
                                                        <div style="margin:0;padding:0;display:inline">
                                                            <p:selectOneMenu id="guestsList_${aud.count}" value="#{valueChangeMB.newTeamRole}" styleClass="study_role_assign" 
                                                                             style="width:170px;" rendered="#{studyManagedBean.renderComponentList() == 'Master'}">
                                                                <p:ajax update="@form" listener="#{valueChangeMB.updateStudyTeamRole(alist.email)}"/>
                                                                <f:selectItems value="#{studyManagedBean.getListBasedOnCurrentRole(alist.email)}" var="ad" itemLabel="#{ad.team}" itemValue="#{ad}"/> 
<!--                                                                            rendered="#{studyManagedBean.getCurrentRole(glist.email) == 'Guest'}"/>-->
                                                                <!--                                                                                  <f:selectItem itemLabel="Guest" itemValue="Guest"/>
                                                                                                                                                  <f:selectItem itemLabel="Master" itemValue="Master"/>
                                                                                                                                                  <f:selectItem itemLabel="Researcher" itemValue="Researcher"/>-->
                                                            </p:selectOneMenu>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="right" align="right">
                                                    <p:commandLink styleClass="ui-button fa fa-minus"  value="" action="#{valueChangeMB.deleteMemberFromTeam(alist.email)}" rendered="#{studyManagedBean.renderComponentList() == 'Master'}" update="@form">
                                                        <p:confirm header="Removing a team member" message="Are you sure you want to remove #{alist.name} [#{alist.email}]?" icon="ui-icon-alert"/>
                                                    </p:commandLink>
                                                    <p:confirmDialog id="notCurrentUser_guest_${aud.count}" global="true" severity="alert" showEffect="fade"> 
                                                        <p:commandButton value="Yes" icon="ui-icon-check" styleClass="ui-confirmdialog-yes" type="submit" update="teamForm"/>   
                                                        <p:commandButton value="No"  icon="ui-icon-close" styleClass="ui-confirmdialog-no" type="button"/>   
                                                    </p:confirmDialog>  
                                                </div>
                                            </div>
                                        </div> 
                                    </li>
                                </c:if> 
                                <c:if id="currentUser_auditor" test="${studyManagedBean.checkCurrentUser(alist.email) eq alist.email}">
                                    <li id="guests_${aud.count}" class="team_member_row">
                                        <div class="row">
                                            <div class="span6">
                                                <img class="avatar s36" src="#{activityBean.getGravatar(alist.email,36)}"/>
                                                <p:commandLink styleClass="dark">
                                                    <strong>#{alist.name}</strong>
                                                    <br/>
                                                    <small class="cgray">
                                                        #{alist.email}
                                                    </small>
                                                </p:commandLink>
                                            </div> 
                                            <div class="span5 right"> 

                                                <div class="left">
                                                    <div id="frmGuest_${aud.count}" class="edit_team_members">
                                                        <div style="margin:0;padding:0;display:inline">
                                                            <p:selectOneMenu id="guestsList_${aud.count}" value="#{valueChangeMB.newTeamRole}" styleClass="study_role_assign" 
                                                                             style="width:170px;" rendered="#{studyManagedBean.renderComponentList() == 'Master'}">
                                                                <p:ajax update="@form" listener="#{valueChangeMB.updateStudyTeamRole(alist.email)}"/>
                                                                <f:selectItems value="#{studyManagedBean.getListBasedOnCurrentRole(alist.email)}" var="ad" itemLabel="#{ad.team}" itemValue="#{ad}"/> 
<!--                                                                            rendered="#{studyManagedBean.getCurrentRole(glist.email) == 'Guest'}"/>-->
                                                                <!--                                                                                  <f:selectItem itemLabel="Guest" itemValue="Guest"/>
                                                                                                                                                  <f:selectItem itemLabel="Master" itemValue="Master"/>
                                                                                                                                                  <f:selectItem itemLabel="Researcher" itemValue="Researcher"/>-->
                                                            </p:selectOneMenu>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="right" align="right">
                                                    <h:commandButton class="btn" value="This is you!" disabled="true"/>
                                                    <p:commandLink styleClass="ui-button fa fa-minus"  value="" action="#{valueChangeMB.deleteMemberFromTeam(alist.email)}" rendered="#{studyManagedBean.renderComponentList() == 'Master'}" update="@form">
                                                        <p:confirm header="Removing a team member" message="Are you sure you want to remove #{alist.name} [#{alist.email}]?" icon="ui-icon-alert"/>
                                                    </p:commandLink>
                                                    <p:confirmDialog id="currentUser_guest_${aud.count}" global="true" severity="alert" showEffect="fade"> 
                                                        <p:commandButton value="Yes" icon="ui-icon-check" styleClass="ui-confirmdialog-yes" type="submit" update="teamForm"/>   
                                                        <p:commandButton value="No"  icon="ui-icon-close" styleClass="ui-confirmdialog-no" type="button"/>   
                                                    </p:confirmDialog>  
                                                </div>
                                            </div>
                                        </div> 
                                    </li>
                                </c:if>    
                            </c:forEach>
                        </ul>
                    </h:panelGroup>

                </c:if>
            </div>
            </h:form>
        </ui:composition>
    </body>
</html>
