<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"   
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      >

    <ui:composition template="layout.xhtml">

        <ui:define name="title">
            BiobankCloud Lims
        </ui:define>
        <ui:define name="css">
            <link rel="stylesheet" type="text/css" href="#{resource['/css/lims.css']}" />
        </ui:define>
        <ui:define name="scripts"/>

        <ui:define name="leftmenu">
            <p:commandLink action="#{bbcController.showNewUserManagementDialog()}">
                <p:outputLabel value="Users" style="font-weight:bold"/>
            </p:commandLink>
        </ui:define>

        


        <ui:define name="dialogs">
       
<!--           New User Management Dialog-->
            <p:dialog modal="true" id="userMgmt" widgetVar="dlgUserManagement" header="User Management" 
                      draggable="true" closable="true" resizable="true" width="825"  height="620">  

<!--<h:form id="formUser">-->
<!--    <p:growl id="growl" showDetail="true" />  -->
    <p:tabView id="tabViewNew" dynamic="true" styleClass="BbcTabView">
<!--        <p:ajax event="tabChange" listener="#{userController.onTabChange}" update=":formUser:growl"/>  -->
        <p:tab title="Registered Users" id="Registered">
                            <p:messages showDetail="true" autoUpdate="true" closable="true"/>
                            <h:form id="userdataForm">
                                
                                     <h:panelGrid id="userdata" columns="4" cellpadding="5">                   
                                    <p:dataTable id="userdataTable" var="user" value="#{userController.allUsers}" filteredValue="#{userController.filteredUsers}" widgetVar="usersTable" emptyMessage="No users found with given criteria"
                                                 selectionMode="single" rowKey="#{user.email}" selection="#{userController.selectedUser}">
                                        
                                                   <f:facet name="header">
                                                       <p:outputPanel>
                                                       <h:outputText value="Search users: " />
                                                       <p:inputText id="globalFilter" onkeyup="usersTable.filter()" style="width:150px" />
                                                       </p:outputPanel>
                                                   </f:facet>
                                        
                                        
                                                   <p:column id="nameColumn" filterBy="name" headerText="Name" style="width:120px">
                                                        <h:outputText value="#{user.name}" />
                                                    </p:column>
                                        
                                                    <p:column id="emailColumn" filterBy="email" headerText="Email" style="width:120px">
                                                        <h:outputText value="#{user.email}" />
                                                    </p:column>
                                        
                                                    <p:column id="usernameColumn" headerText="Username" style="width:120px">
                                                        <h:outputText value="#{user.username}" />
                                                    </p:column>
                                        
                                                    <p:column id="mobileNumColumn" headerText="Mobile Number">
                                                        <h:outputText value="#{user.mobileNum}" />
                                                    </p:column>
                                                                                         
                                         </p:dataTable>
                                             <f:facet name="footer">
                                                        <p:commandButton value="Delete" update="userdata" icon="ui-icon-search" style="margin-right:10px" oncomplete="PF('userDialog').show()"/>
                                             </f:facet>
                                                                                   
                                      <p:dialog id="dialog" header="Selected User" widgetVar="userDialog" draggable="true" resizable="false" width="250" showEffect="clip" hideEffect="fold">

                                              <h:panelGrid id="display" columns="2" cellpadding="4">

                                                  <h:outputText value="Name:" />
                                                  <h:outputText value="#{userController.selectedUser.name}" />

                                                  <h:outputText value="Email:" />
                                                  <h:outputText value="#{userController.selectedUser.email}" />

                                                  <h:outputText value="Username:" />
                                                  <h:outputText value="#{userController.selectedUser.username}" />

                                             </h:panelGrid>
                                         
                                          <f:facet name="footer">
                                                      <h:outputText id="deletemsg" value="Are you sure you want to remove this user?" />
                                                      <p:commandButton value="Confirm" update="display" icon="ui-icon-close" style="margin-right:10px" action="#{userController.deleteUser()}"/>
                                          </f:facet>
                                          
                                    </p:dialog>
                                </h:panelGrid>
                                   </h:form>   
                              </p:tab>                 
                                      
                                          
    
                        
                        <!-- user view end -->
               
            <!-- Add Users-->
                        
            <p:tab title="Add New Users" id="New">
                <p:messages  autoUpdate="true" closable="true"/>
             <h:form id="addUsers">
                 
                    <p:panel header="User Data"> 
                   
                       <h:panelGrid id="grid" columns="4" cellpadding="5">    
                           
                  
                            <h:outputLabel for="name" value="Name:" style="font-weight:bold"/>					
                            <p:inputText id="name" required="true" label="Name" value="#{userController.user.name}" autocomplete="off" validatorMessage="Name cannot be empty"/>
                            <p:message for="name" />
                            <h:outputText value=""/>

                            <h:outputLabel for="email" value="Email:" style="font-weight:bold"/>					
                            <p:inputText id="email"  required="true" label="Email" value="#{userController.user.email}" autocomplete="off" validatorMessage="Not a valid email">
                                <f:validateRegex pattern="([^.@]+)(\.[^.@]+)*@([^.@]+\.)+([^.@]+)" />
                            </p:inputText>
                            <p:message for="email" />
                            <h:outputText value=""/>

                            <h:outputLabel for="uname" value="Username:" style="font-weight:bold"/>					
                            <p:inputText id="uname" required="true" label="Username" value="#{userController.user.username}" autocomplete="off" validatorMessage="Username cannot be empty">
                            </p:inputText>
                            <p:message for="uname" />
                            <h:outputText value=""/>

                            <h:outputLabel for="password" value="Password:" style="font-weight:bold"/>					
                            <p:password id="password" label="password" required="true" value="#{userController.user.password}" validatorMessage="password is required">
                            </p:password>
                            <p:message for="password" />
                            <h:outputText value=""/>
                                
                            <h:outputLabel for="mobile" value="Mobile Number:" style="font-weight:bold"/>					
                            <p:inputText id="mobile" label="Mobile Number" value="#{userController.user.mobileNum}" autocomplete="off" validatorMessage="Only Numbers (10 digits)">
                                <f:validateRegex pattern="[0-9]{1,10}"/>                                
                            </p:inputText>
                            <p:message for="mobile"/>
                            <h:outputText value=""/>                     
                     </h:panelGrid>
                   
                   
                   <f:facet name="footer">
                       <p:commandButton update="grid" value="Add" icon="ui-icon-plus" style="margin-right:10px" action="#{userController.addUser()}" validateClient="true"/>
                   </f:facet> 
             </p:panel>
           </h:form>
          </p:tab>
          
            
            
            
            <!-- End add users-->
           
                  
                 </p:tabView>
<!--</h:form>-->

            </p:dialog>
        </ui:define>
    </ui:composition>
</html>
                    
         
        
                               
                                    
                                
                                
                               
            
                            

            
            
     