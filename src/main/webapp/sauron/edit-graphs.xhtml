<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"   
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      >

    <ui:composition template="layout.xhtml">

        <ui:define name="title">Edit Graphs</ui:define>

        <ui:define name="content">

            <p:spacer width="1" height="10" />

            <h:form id="formMsg">
                <p:growl id="msgGrowl" showDetail="true"/>  
            </h:form>   

            <div class="hosts-header">
                <p:outputLabel id="title">
                    Edit Graphs:
                </p:outputLabel>
            </div>

            <!-- Dialog Import Graphs -->
            <p:dialog modal="true" widgetVar="dlgImport" header="Import Graph" draggable="false" 
                      closable="true" resizable="false" width="500" height="200">  
                <h:panelGrid columns="1" >
                    <p:outputLabel value="Choose a graph description file to import:"/>               
                    <h:form enctype="multipart/form-data">  
                        <p:fileUpload fileUploadListener="#{importGraphController.handleUpload}" 
                                      oncomplete="dlgProgress.hide(); dlgImport.hide()" onstart="dlgImport.hide(); dlgProgress.show()"
                                      mode="advanced"  
                                      update=":formMsg :formMain"  
                                      auto="true"  
                                      sizeLimit="1000000000"   
                                      allowTypes="/(\.|\/)(json)$/"
                                      label="Choose" 
                                      styleClass="FileUpload"/>
                    </h:form>    
                </h:panelGrid>
            </p:dialog>  

            <p:dialog modal="true" widgetVar="dlgProgress" header="Importing graphs..." 
                      draggable="false" closable="true" resizable="false">  
                <p:graphicImage library="images" name="ajaxloadingbar.gif" />  
            </p:dialog>             
            <!-- Dialog Import Graphs - End -->

            <!-- Dialog New Graph -->
            <p:dialog modal="true" widgetVar="dlgNewGraph" header="New Graph" draggable="true" closable="true" resizable="false" width="1024"  >  

                <h:form id="formNew" >  

                    <h:panelGrid columns="3" cellpadding="4">  
                        <h:outputText value="Graph Id:" style="white-space: nowrap"/>  
                        <p:inputText id="id" value="#{graphControllerNew.graph.graphId}" required="true" style="min-width: 242px">
                            <p:ajax event="keyup" update=":formNew:validity" listener="#{graphControllerNew.checkGraphId()}"/>                     
                        </p:inputText>

                        <p:spacer width="40" height="1" >
                            <p:outputPanel id="validity" >
                                <p:outputPanel  rendered="#{not empty graphControllerNew.graph.graphId and graphControllerNew.idValid}">
                                    <span class="ui-icon ui-icon-check green" style="display:inline-block;" title="Id is unique"/>
                                </p:outputPanel>                          
                                <p:outputPanel  rendered="#{not empty graphControllerNew.graph.graphId and not graphControllerNew.idValid}">
                                    <span class="ui-icon ui-icon-notice" style="display:inline-block;" title="Id must be unique: A graph with this id already exists"/>
                                </p:outputPanel> 
                                <p:outputPanel  rendered="#{empty graphControllerNew.graph.graphId}">
                                    <span class="ui-icon ui-icon-notice" style="display:inline-block;" title="Enter a unique id"/>
                                </p:outputPanel>                                 
                            </p:outputPanel>
                        </p:spacer>

                        <h:outputText value="Target:" />  
                        <p:selectOneMenu  id="target" required="true" value="#{graphControllerNew.graph.target}" style="min-width: 250px">                                
                            <f:selectItem itemLabel="Select Target" noSelectionOption="true"/> 
                            <f:selectItems value="#{graphControllerStatic.targets}" var="target" itemLabel="#{target}" itemValue="#{target}"/>  
                            <p:ajax update=":formNew:group :formNew:plugin :formNew:pluginInstance :formNew:charts" listener="#{graphControllerNew.loadGroupsAndPlugins()}"/> 
                        </p:selectOneMenu>                              
                        <p:spacer width="1" height="1" />

                        <h:outputText value="Group:"/>  
                        <p:selectOneMenu id="group" value="#{graphControllerNew.graph.group}" editable="true" required="true" style="min-width: 250px">   
                            <f:selectItems value="#{graphControllerNew.groups}" var="group" itemLabel="#{group}" itemValue="#{group}"/>  
                        </p:selectOneMenu>                            
                        <p:spacer width="1" height="1" />

                        <h:outputText value="Plugin:"/>  
                        <p:selectOneMenu id="plugin" value="#{graphControllerNew.graph.plugin}" editable="true" required="true" style="min-width: 250px">
                            <f:selectItems value="#{graphControllerNew.plugins}" var="plugin" itemLabel="#{plugin}" itemValue="#{plugin}"/>  
                            <p:ajax update=":formNew:pluginInstance :formNew:charts" listener="#{graphControllerNew.loadPluginInstance()}"/> 
                        </p:selectOneMenu> 
                        <p:spacer width="1" height="1" />

                        <h:outputText value="Plugin-Instance:" style="white-space: nowrap"/>
                        <p:selectOneMenu id="pluginInstance" value="#{graphControllerNew.graph.pluginInstance}" editable="true" style="min-width: 250px">
                            <f:selectItems value="#{graphControllerNew.pluginInstances}" var="instance" itemLabel="#{instance}" itemValue="#{instance}"/>
                            <p:ajax update=":formNew:charts" listener="#{graphControllerNew.pluginInstanceChanged()}"/>
                        </p:selectOneMenu>
                        <p:spacer width="1" height="1" />

                        <h:outputText value="Title:"/>
                        <p:inputText value ="#{graphControllerNew.graph.title}" style="min-width: 242px"/>
                        <p:spacer width="1" height="1" />

                        <h:outputText value="Vertical Label:" style="white-space: nowrap"/>
                        <p:inputText value ="#{graphControllerNew.graph.verticalLabel}" style="min-width: 242px"/>
                        <p:spacer width="1" height="1" />

                        <h:outputText value="Var:"/>
                        <p:inputText id="var" value ="#{graphControllerNew.graph.var}" title="Example: n=1..COUNT(KTHFS,namenode);host=HOST(KTHFS,namenode)" style="min-width: 242px"/>
                        <p:tooltip for="var" showEvent="focus" hideEvent="blur" />
                        <p:spacer width="1" height="1" />                        
                    </h:panelGrid> 

                    <p:dataTable var="chart" value="#{graphControllerNew.graph.charts}" id="charts">  
                        <f:facet name="header">Charts</f:facet>                          
                        <p:column headerText="Model">  
                            <h:outputText value="#{chart.model}" />  
                        </p:column>  
                        <p:column headerText="Type">  
                            <h:outputText value="#{chart.type}" />  
                        </p:column>                  
                        <p:column headerText="Type Instance">  
                            <h:outputText value="#{chart.typeInstance}" />  
                        </p:column>                        
                        <p:column headerText="Data Set">  
                            <h:outputText value="#{chart.ds}" />  
                        </p:column>                        
                        <p:column headerText="Label">  
                            <h:outputText value="#{chart.label}" />  
                        </p:column>                        
                        <p:column headerText="Color">  
                            <h:outputText value="#{chart.color}" />  
                        </p:column>                        
                        <p:column headerText="Format">  
                            <h:outputText value="#{chart.format}" />  
                        </p:column>                        
                        <p:column headerText="RRD File">  
                            <h:outputText value="#{chart.rrdFileName}" />  
                        </p:column> 
                    </p:dataTable>                      

                    <p:spacer width="1" height="30" />   

                    <p:outputPanel style="float: right">                   
                    <p:spacer width="1" height="30" /> 
                        <p:commandButton id="newChart" value="New Chart" icon="ui-icon-plusthick" actionListener="#{graphControllerNew.showNewChartDialog}" update=":formNew"/> 

                        <p:commandButton id="add" value="Save" icon="ui-icon-disk" actionListener="#{graphControllerNew.addGraph}" 
                                         update=":formNew" />                         
                    </p:outputPanel> 
                </h:form>
                <p:spacer width="1" height="25" />                  
            </p:dialog>
            <!-- Dialog New Graph - End -->


            <!-- Dialog New Chart -->
            <p:dialog modal="true" widgetVar="dlgNewChart" header="New Chart" draggable="false" closable="true" resizable="false" width="500" height="300">  
                <h:form id="formNewChart" styleClass="DlgNewChar">  
                    <h:panelGrid columns="3" cellpadding="4">   
                        <h:outputText value="Type:"/>  
                        <p:selectOneMenu id="type" value="#{graphControllerNew.chart.type}" required="true" editable="true">   
                            <f:selectItems value="#{graphControllerNew.types}" var="type" itemLabel="#{type}" itemValue="#{type}"/>  
                            <p:ajax update=":formNewChart:typeInstance :formNewChart:typeInstanceInfo :formNewChart:model :formNewChart:color" 
                                    listener="#{graphControllerNew.loadTypeInstances()}"/>                             
                        </p:selectOneMenu>                            
                        <p:spacer width="1" height="1" />                        

                        <h:outputText value="Type-Instance:"/>  
                        <p:selectOneMenu id="typeInstance" value="#{graphControllerNew.chart.typeInstance}" required="true" editable="true">   
                            <f:selectItems value="#{graphControllerNew.typeInstances}" var="typeInstance" itemLabel="#{typeInstance}" itemValue="#{typeInstance}"/> 
                            <p:ajax update=":formNewChart:typeInstanceInfo"/>    
                        </p:selectOneMenu>                                     
                        <p:outputPanel id="typeInstanceInfo">
                            <p:outputPanel rendered="#{not empty graphControllerNew.typeInstanceInfo}">
                                <span class="ui-icon ui-icon-help" style="display:inline-block;" title="#{graphControllerNew.typeInstanceInfo}"/>
                            </p:outputPanel>  
                            <p:outputPanel rendered="#{empty graphControllerNew.typeInstanceInfo}">
                                <p:spacer width="1" height="1" />                             
                            </p:outputPanel>                            
                        </p:outputPanel>                        

                        <h:outputText value="Data Set:"/>
                        <p:inputText value ="#{graphControllerNew.chart.ds}" required="true"/>
                        <p:spacer width="1" height="1" />

                        <h:outputText value="Model:"/>  
                        <p:selectOneMenu id="model" value="#{graphControllerNew.chart.model}" required="true">                            
                            <f:selectItems value="#{graphControllerStatic.models}" var="model" itemLabel="#{model}" itemValue="#{model}"/>  
                        </p:selectOneMenu>                            
                        <p:spacer width="1" height="1" />


                        <h:outputText value="Color:"/>  
                        <p:selectOneMenu id="color" value="#{graphControllerNew.chart.color}" required="true">   
                            <f:selectItems value="#{graphControllerStatic.colors}" var="color" itemLabel="#{color}" itemValue="#{color}"/>  
                        </p:selectOneMenu>                            
                        <p:spacer width="1" height="1" />                           

                        <h:outputText value="Label:"/>
                        <p:inputText value ="#{graphControllerNew.chart.label}" required="true"/>
                        <p:spacer width="1" height="1" /> 

                        <h:outputText value="Format:"/>  
                        <p:selectOneMenu id="format" value="#{graphControllerNew.chart.format}" editable="true">   
                            <f:selectItems value="#{graphControllerStatic.formats}" var="format" itemLabel="#{format}" itemValue="#{format}"/>  
                        </p:selectOneMenu>   
                        <p:spacer width="1" height="1" /> 

                        <p:spacer width="1" height="1" />                          
                        <p:outputPanel style="float: right">
                            <p:spacer width="1" height="25"/>                         
                            <p:commandButton id="addChart" value="Add" icon="ui-icon-check"
                                             actionListener="#{graphControllerNew.addChart}" update=":formNew :formNewChart" />
                        </p:outputPanel>                      
                    </h:panelGrid> 
                </h:form>
            </p:dialog>                        

            <!-- Dialog New Chart - End -->






            <!-- Form Graphs -->
            <h:form id="formMain">
                <h:panelGrid columns="5"> 
                    <p:selectOneMenu value="#{urlController.target}" widgetVar="target">
                        <f:selectItem itemLabel="Select Target" itemValue="" />  
                        <f:selectItems value="#{graphControllerStatic.targets}" var="target" itemLabel="#{target}" itemValue="#{target}"/>  
                        <p:ajax event="change" listener="#{urlController.redirectToEditGraphs()}"/>                        
                    </p:selectOneMenu> 

                    <p:commandButton value="Import" icon="ui-icon-arrowreturnthick-1-s" onclick="dlgImport.show()"/>  
                    <p:commandButton value="New" icon="ui-icon-plusthick" action="#{graphControllerNew.showNewGraphDialog}"/>  

                    <p:outputLabel style="color:red; font-size: small">#{editGraphsController.message}</p:outputLabel>
                </h:panelGrid>

                <p:dataTable id="graphs" var="graph" value="#{editGraphsController.graphs}"
                             selection="#{editGraphsController.selectedGraphs}" 
                             rowKey="#{graph.graphId}" styleClass="GraphsTable">    

                    <f:facet name="header">Graphs</f:facet>  
                    <p:column selectionMode="multiple" style="width:2%" /> 
                    <p:column headerText="Id">  
                        <h:outputText value="#{graph.graphId}" />  
                    </p:column>                           
                    <p:column headerText="Target">  
                        <h:outputText value="#{graph.target}" />  
                    </p:column>                        
                    <p:column headerText="Group">  
                        <h:outputText value="#{graph.group}" />  
                    </p:column>                      
                    <p:column headerText="Plugin">  
                        <h:outputText value="#{graph.plugin}" />  
                    </p:column>  
                    <p:column headerText="Plugin Instance">  
                        <h:outputText value="#{graph.pluginInstance}" />  
                    </p:column>  
                    <p:column headerText="Title">
                        <h:outputText value="#{graph.title}" />  
                    </p:column>  
                    <p:column headerText="Vertical Label">
                        <h:outputText value="#{graph.verticalLabel}" />  
                    </p:column>  
                    <p:column headerText="Var">
                        <h:outputText value="#{graph.var}" />  
                    </p:column>                          
                    <p:column style="width:4%">  
                        <p:commandButton id="selectButton" oncomplete="dialog1.show()" update=":formMain:graphDlg" icon="ui-icon-search" title="Detail">  
                            <f:setPropertyActionListener value="#{graph}" target="#{editGraphsController.selectedGraph}" />  
                        </p:commandButton>  
                    </p:column> 
                    <f:facet name="footer" >  
                        <p:commandButton value="Save" icon="ui-icon-disk" actionListener="#{editGraphsController.save()}" update=":formMsg" 
                                         disabled="#{empty editGraphsController.graphs}"/>
                    </f:facet>       
                </p:dataTable>

                <p:dialog header="Graph Detail" widgetVar="dialog1" resizable="false" id="graphDlg" modal="true">  
                    <p:spacer width="1" height="10" />
                    <p:dataTable var="graph" value="#{editGraphsController.selectedGraph}" id="graph">  
                        <f:facet name="header">Graph</f:facet>                            
                        <p:column headerText="Id">  
                            <h:outputText value="#{graph.graphId}" />  
                        </p:column>  
                        <p:column headerText="Target">  
                            <h:outputText value="#{graph.target}" />  
                        </p:column>                        
                        <p:column headerText="Group">  
                            <h:outputText value="#{graph.group}" />  
                        </p:column>                          
                        <p:column headerText="Plugin">  
                            <h:outputText value="#{graph.plugin}" />  
                        </p:column>  
                        <p:column headerText="Plugin Instance">  
                            <h:outputText value="#{graph.pluginInstance}" />  
                        </p:column>  
                        <p:column headerText="Title">
                            <h:outputText value="#{graph.title}" />  
                        </p:column>  
                        <p:column headerText="Vertical Label">
                            <h:outputText value="#{graph.verticalLabel}" />  
                        </p:column>  
                        <p:column headerText="Var">
                            <h:outputText value="#{graph.var}" />  
                        </p:column>                          
                    </p:dataTable>

                    <p:spacer width="1" height="20" />

                    <p:dataTable var="chart" value="#{editGraphsController.selectedGraph.charts}" id="charts">  
                        <f:facet name="header">Charts</f:facet>                          
                        <p:column headerText="Model">  
                            <h:outputText value="#{chart.model}" />  
                        </p:column>  
                        <p:column headerText="Type">  
                            <h:outputText value="#{chart.type}" />  
                        </p:column>                  
                        <p:column headerText="Type Instance">  
                            <h:outputText value="#{chart.typeInstance}" />  
                        </p:column>                        
                        <p:column headerText="Data Set">  
                            <h:outputText value="#{chart.ds}" />  
                        </p:column>                        
                        <p:column headerText="Label">  
                            <h:outputText value="#{chart.label}" />  
                        </p:column>                        
                        <p:column headerText="Color">  
                            <h:outputText value="#{chart.color}" />  
                        </p:column>                        
                        <p:column headerText="Format">  
                            <h:outputText value="#{chart.format}" />  
                        </p:column>                        
                        <p:column headerText="RRD File">  
                            <h:outputText value="#{chart.rrdFileName}" />  
                        </p:column> 
                    </p:dataTable>                    
                    <p:spacer width="1" height="10" />
                </p:dialog>  
            </h:form>
            <!-- Form Graphs - End -->

        </ui:define>

    </ui:composition>

</html>