<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">
    <f:view contentType="text/html">

        <h:head>
            <title><ui:insert name="title">BioBankCloud Registration</ui:insert></title>
            <link rel="stylesheet" type="text/css" href="#{resource['/css/signup.css']}" />
            <link rel="stylesheet" type="text/css" href="#{resource['/css/layout.css']}" />

        </h:head>

        <h:body >
            <ui:insert name="titleBar" >
                <ui:include src="/bbc/lims/titleBar.xhtml" />       
            </ui:insert>

            <div align="center">
                <h:panelGrid 
                    columns="#{customAuthenticationSwitch.otpEnabled?2:1}" 
                    styleClass="registerContainer">

                    <h:panelGroup styleClass="MobileRegistation" >
                        <h3>Create your BiobankCloud Account</h3>

                        <h:form class="register_form"> 
                            <h:panelGrid columns="4" >			

                                <p:inputText id="fname" 
                                             value="#{userRegistration.fname}" 
                                             type="text"
                                             required="true"
                                             autocomplete="off"
                                             requiredMessage="Enter first name" />
                                <p:watermark for="fname" value="First name" />


                                <p:inputText id="lname"
                                             value="#{userRegistration.lname}" 
                                             required="true"
                                             autocomplete="off"
                                             requiredMessage="Enter last name"/>
                                <p:watermark for="lname" value="Last name" />

                                <p:inputText id="email"
                                             value="#{userRegistration.mail}" 
                                             required="true"
                                             autocomplete="off"
                                             requiredMessage="Enter email">
                                    <f:validator binding="#{usernameValidator}" />
                                </p:inputText>    
                                <p:watermark for="email" value="Enter your email" />

                                <p:inputText id="tel" 
                                             value="#{userRegistration.tel}" 
                                             autocomplete="off"
                                             validatorMessage="Invalid phone number">
                                    <f:validateRegex pattern="^([+]?[\d]+)?$" />
                                </p:inputText>
                                <p:watermark for="tel" value="Enter your telephone number" />
                                <p:password id="password0" 
                                            value="#{userRegistration.password}" 
                                            required="true"
                                            autocomplete="off"
                                            requiredMessage="Enter password">
                                    <f:validator validatorId="passwordValidator" />
                                    <f:attribute name="confirmPassword" value="#{confirmPassword}" />
                                </p:password>
                                <p:watermark for="password0" value="Choose a pasword" />

                                <p:password id="password" 
                                            value="#{userRegistration.passwordAgain}"
                                            requiredMessage="Re-enter password"
                                            autocomplete="off" 
                                            binding="#{confirmPassword}"
                                            required="true">
                                </p:password>
                                <p:watermark for="password" value="Repeat the pasword" />

                            </h:panelGrid>

                            <h:panelGrid columns="2" >			

                                <p:selectOneMenu id="sec_question"
                                                 value="#{userRegistration.security_question}" 
                                                 required="true"
                                                 style="width: 508px; height: 30px; " 
                                                 requiredMessage="Select security question">

                                    <f:selectItem itemLabel="Select Security Question for Password Recovery" 

                                                  itemValue="" />
                                    <f:selectItems value="#{userRegistration.questions}"/>
                                </p:selectOneMenu>  
                                <p:spacer></p:spacer>

                                <p:inputText id="answer"
                                             value="#{userRegistration.security_answer}"
                                             style="width: 508px"
                                             required="true"
                                             autocomplete="off"
                                             requiredMessage="Answer security question" />
                                <p:watermark for="answer" value="Enter your security answer" />


                                <p:captcha id ="captcha" 
                                           label="Captcha"
                                           required="true" 
                                           requiredMessage="Enter Captcha"/>

                                <p:spacer></p:spacer>

                                <h:panelGroup style="padding: 10">
                                    <p:selectBooleanCheckbox 
                                        value="#{userRegistration.tos}"> 
                                        <f:validator binding="#{tosCheckboxValidator}" />
                                    </p:selectBooleanCheckbox> 
                                    <p:spacer width="5"></p:spacer>
                                    <p:commandLink 
                                        action="tos.xhtml"
                                        ajax="false" 
                                        value=" I agree to the BiobankCloud Terms of Service (ToS)"
                                        immediate="true" target="_blank">
                                    </p:commandLink>
                                </h:panelGroup>
                            </h:panelGrid>
                            <p:messages id="messages" showDetail="false" autoUpdate="true" closable="true"/>

                            <div class="register_user">
                            <p:commandButton  
                                              type="submit"
                                              value="Register" 
                                              oncomplete="Recaptcha.reload();" 
                                              action="#{userRegistration.registerMobileUser()}"/>
                        
                           <p:spacer width="10"></p:spacer>
                           
                            <p:commandButton  
                                              type="submit"
                                              value="Cancel" 
                                              action="welcome" 
                                              immediate="true" 
                                              />
                            </div>
                        </h:form> 
                    </h:panelGroup>

                    <h:panelGroup rendered="#{customAuthenticationSwitch.otpEnabled}"
                                  styleClass="registerPanel">
                        
                        <div id="mobile_user_guide" style="padding-left: 150px;" align="left">
                            
                            <h3 align="left">Why mobile two-step verification?</h3>
                       
                            <p>
                                It's easier than you think for someone to steal your password.
                                <br></br>
                                Any of these common actions could put you at risk of having your password stolen:
                                <ul>
                                    <li>Using the same password on more than one site</li>
                                    <li>Downloading software from the Internet</li>
                                    <li>Clicking on links in email messages</li>
                                </ul>
                                2-Step Verification can help keep bad guys out, even if they have your password.
                                <br></br>
                                <br></br>
                                <p style="width: 500px;">
                                    In order to use mobile verification you need to install Google Authenticator on your mobile
                                    device (such as Apple iPhone, iPad, Google Nexus). 
                                    For instructions on how to do this, refer to: 
                                    <a style="color: #075fa9;font-style: italic" target="_blank" 
                                       href="https://support.google.com/accounts/answer/1066447?hl=en"> 
                                        Installing Google Authenticator.
                                    </a> 

                                    <br></br>
                                    <br></br>
                                    After submitting the form on the left, a QR code as shown below will be generated and you need to scan it with your device.
                                    <br></br>
                                    <br></br>
                                    <div align="center">
                                        <p:graphicImage library="images" name="icons/qrcode.png" style="width: 100px; height: 100px;" ></p:graphicImage>
                                    </div>
                                    <br></br>
                                </p>
                                <div align="left">
                                    <p style="width: 500px; height: auto;">
                                        After loading the code, every 30 seconds a new one-time password will be generated by Google Authenticator.
                                        You will be required to provide this one-time password as PIN in addition to your password.
                                    </p>
                                    <br></br>
                                    <div align="center" >   
                                        <p:graphicImage library="images" name="icons/gauth.png" style="float: inside; width: 200px; height: 300px; "></p:graphicImage>
                                    </div>
                                    <br></br>
                                    <p style="width: 500px; height: auto;">
                                        Please note that the generated one-time password will not be sent to your mobile number. 
                                        The one-time password will be generated on your device in the Google Authenticator app. 
                                    </p>
                                </div>  
                            </p>
                        </div>                    
                    </h:panelGroup>
                </h:panelGrid>
            </div>   
        </h:body>
    </f:view>
</html> 
