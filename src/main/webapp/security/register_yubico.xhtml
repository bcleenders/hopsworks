<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">
    <f:view contentType="text/html">

        <h:head>
            <title><ui:insert name="title">BioBankCloud Registration</ui:insert></title>
           <link rel="stylesheet" type="text/css" href="#{resource['/css/security.css']}" />
            <link rel="stylesheet" type="text/css" href="#{resource['/css/layout.css']}" />

        </h:head>

        <h:body  style="background-color: white;">
            <ui:insert name="titleBar" >
                <ui:include src="/bbc/lims/titleBar.xhtml" />       
           </ui:insert>
            <div align="center">
                
                <h:panelGrid columns="#{customAuthenticationSwitch.otpEnabled?2:1}" styleClass="registerContainer">
                    <h:panelGroup  styleClass="registerPanel">
                            <ul class="register_banner">
                                <h3 align="left">Request Yubikey Account</h3>
                            </ul>

                            <h:form > 

                                <h:panelGrid columns="2" >			
                                    <p:outputLabel for="fname" value="First name"/>
                                    <p:inputText id="fname" value="#{userRegistration.fname}" 
                                                 size="41"
                                                 required="true"
                                                 autocomplete="off"
                                                 requiredMessage="Enter first name" />

                                    <p:outputLabel for="lname" value="Last name"/>
                                    <p:inputText id="lname" value="#{userRegistration.lname}" 
                                                 size="41"
                                                 required="true"
                                                 autocomplete="off"
                                                 requiredMessage="Enter last name"/>

                                    <p:outputLabel for="email" value="Email" />
                                    <p:inputText id="email" value="#{userRegistration.mail}" 
                                                 size="41"
                                                 required="true"
                                                 autocomplete="off"
                                                 requiredMessage="Enter email">
                                        <f:validator binding="#{usernameValidator}" />
                                    </p:inputText>    

                                    <p:outputLabel for="tel" value="Phone number" />
                                    <p:inputText id="tel" value="#{userRegistration.tel}"
                                                 size="41"
                                                 autocomplete="off"
                                                 validatorMessage="Invalid phone number">
                                        <f:validateRegex pattern="^([+]?[\d]+)?$" />
                                    </p:inputText>

                                    <p:outputLabel for="address1" value="C/O"/>
                                    <p:inputText id="address1" value="#{userRegistration.address1}" 
                                                 size="41"
                                                 autocomplete="off"
                                                 >
                                    </p:inputText>

                                    <p:outputLabel for="address2" value="Street and number"/>
                                    <p:inputText id="address2" value="#{userRegistration.address2}" 
                                                 required="true"
                                                 autocomplete="off"
                                                 size="41"
                                                 requiredMessage="Enter street" >
                                    </p:inputText>

                                    <p:outputLabel for="city1" value="City"/>
                                    <p:inputText id="city1" value="#{userRegistration.city}" 
                                                 required="true"
                                                 autocomplete="off"
                                                 requiredMessage="Enter city" 
                                                 size="41">
                                    </p:inputText>

                                    <p:outputLabel for="zip1" value="Postal code" />
                                    <p:inputText id="zip1" value="#{userRegistration.postalcode}" 
                                                 required="true"
                                                 autocomplete="off"
                                                 size="41"
                                                 requiredMessage="Enter postal code">
                                    </p:inputText>

                                    <p:outputLabel for="country1" value="Country" />
                                    <p:inputText id="country1" value="#{userRegistration.country}"  
                                                 required="true"
                                                 autocomplete="off"
                                                 size="41"
                                                 requiredMessage="Enter country">
                                    </p:inputText>

                                    <p:outputLabel for="sec_question1" value="Security Question"/>
                                    <p:selectOneMenu id="sec_question1" value="#{userRegistration.security_question}"
                                                     required="true"
                                                     requiredMessage="Select security question" >
                                        <f:selectItem itemLabel="Select security question" itemValue="" />
                                        <f:selectItem itemLabel="Who is your favorite historical figure?" itemValue="history" />
                                        <f:selectItem itemLabel="What is the name of your favorite teacher?" itemValue="teacher" />
                                        <f:selectItem itemLabel="What is your first phone number?" itemValue="phone" />
                                        <f:selectItem itemLabel="What is the name of your favorite childhood friend?" itemValue="friend" />

                                    </p:selectOneMenu>  

                                    <p:outputLabel for="answer1" value="Answer"/>
                                    <p:inputText id="answer1" value="#{userRegistration.security_answer}" 
                                                 size="41"
                                                 autocomplete="off"
                                                 required="true"
                                                 requiredMessage="Enter answer">
                                    </p:inputText>  

                                    <p:outputLabel for="pass0" value="Password"/>
                                    <p:password id="pass0" value="#{userRegistration.password}" 
                                                required="true" 
                                                size="41"
                                                autocomplete="off"
                                                requiredMessage="Enter password">
                                        <f:validator validatorId="passwordValidator" />
                                        <f:attribute name="confirmPassword" value="#{confirmPassword}" />
                                    </p:password>

                                    <p:outputLabel for="pass" value="Password again"/>
                                    <p:password id="pass" value="#{userRegistration.passwordAgain}" 
                                                size="41"
                                                requiredMessage="Re-enter password"
                                                autocomplete="off"
                                                binding="#{confirmPassword}"
                                                required="true">
                                    </p:password>

                                    <p:outputLabel for="captcha" value="Enter Captcha"/>
                                    <p:captcha id ="captcha" label="Captcha" 
                                               required="true" 
                                               requiredMessage="Enter Captcha"/>

                                    <p:spacer></p:spacer>
                                    <h:panelGroup> 
                                        <p:selectBooleanCheckbox value="#{userRegistration.tos}">
                                             <f:validator binding="#{tosCheckboxValidator}" />
                                        </p:selectBooleanCheckbox>
                                        &nbsp;
                                        <p:commandLink action="tos" style="margin-right:20px; color: #0971B2"
                                                       ajax="false" value=" I agree to the BBC Terms of Service (ToS)"
                                                       immediate="true" target="_blank" >
                                            
                                        </p:commandLink>
                                   </h:panelGroup>

                                    <p:spacer></p:spacer>
                                    <p:messages id="messages" autoUpdate="true" closable="true"  showDetail="false" />
                                    
                                </h:panelGrid>

                                <div class="register_banner">
                                    <p:commandButton styleClass="team_button button-save" type="submit" oncomplete="Recaptcha.reload();" value="Register" action="#{userRegistration.registerYubikey()}" />
                                    <p:commandButton styleClass="team_button button-save" type="submit" value="Cancel" action="welcome" immediate="true" style="margin-left: 55px"/>
                                </div>

                            </h:form> 
                    </h:panelGroup>
                    <h:panelGroup rendered="#{customAuthenticationSwitch.otpEnabled}" styleClass="registerPanel">
                        <ul class="register_banner">
                            <h3 align="left">Why Yubikey 2-Step verification?</h3>
                        </ul>

                        <div  id="mobile_user_guide" align="left">     
                            <p>
                                It's easier than you think for someone to steal your password.
                                <br></br>
                                Any of these common actions could put you at risk of having your password stolen:
                                <ul>
                                    <li>Using the same password on more than one site</li>
                                    <li>Downloading software from the Internet</li>
                                    <li>Clicking on links in email messages</li>
                                </ul>
                                2-Step Verification can help keep bad guys out, even if they have your password.

                                <br></br>

                                <p style="width: 500px;">
                                    The Yubikey is a hardware authentication device that changes passwords every time it is used. 
                                    <em>Yubikey authentication is an option for users who don't use mobile devices for authentication.</em>
                                </p>

                                <div align="center">
                                    <p:graphicImage library="images" name="icons/yubikey.png" height="150px;" width="150px;"></p:graphicImage>
                                </div>
                                <br></br>
                                <p style="width: 500px;">
                                    In order to use Yubikey verification you need to insert the device into the USB port and press a button.
                                </p>

                                <div align="center">
                                    <p:graphicImage library="images" name="icons/yubiko.jpg" height="200px;" width="200px;"></p:graphicImage>
                                </div>
                                <br></br>                           
                                <p style="width: 500px;">
                                    Every time you press the Yubikey button, a new one-time password will be generated. You will be required to provide this one-time password as PIN in addition to your password.
                                </p>
                            </p>
                        </div>                    
                    </h:panelGroup>
                </h:panelGrid>
            </div>
        </h:body>
    </f:view>
</html>