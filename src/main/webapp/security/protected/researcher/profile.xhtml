<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"   
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">
    <f:view contentType="text/html">

        <h:head>
            <title><ui:insert name="title">BioBankCloud LIMS Profile</ui:insert></title>
            <link rel="stylesheet" type="text/css" href="#{resource['/css/profile.css']}" />
            <link rel="stylesheet" type="text/css" href="#{resource['/css/layout.css']}" />
            <meta http-equiv="refresh" content="#{facesContext.externalContext.sessionMaxInactiveInterval};url=#{request.contextPath}/index.xhtml"/>
        </h:head>

        <h:body>
            <ui:insert name="titleBar" >
                <ui:include src="/bbc/lims/titleBar.xhtml"  /> 
            </ui:insert>

            <div align="center" class="UserProfile">

                <div class="PersonalInfo">
                    <h3 > Personal Info</h3>

                    <p:panelGrid id="profile_head" columns="4" styleClass="PersonalIfo">

                        <p:column>
                            <h3 style="color: rgba(0, 0, 0, 0.87); font-weight: 400;">Name</h3>
                        </p:column>   

                        <p:column>
                            <h3 style="color: rgba(0, 0, 0, 0.54); font-weight: 400;"> 
                                #{profileManager.user.title} #{profileManager.user.fname} #{profileManager.user.lname} 
                            </h3>
                        </p:column>

                        <p:column>
                            <h3 style="color: rgba(0, 0, 0, 0.87); font-weight: 400;">Member Since</h3>
                        </p:column>   

                        <p:column>
                            <h3 style="color: rgba(0, 0, 0, 0.54); font-weight: 400;"> 
                                #{profileManager.user.activated}
                            </h3>
                        </p:column>

                        <p:column>
                            <h3 style="color: rgba(0, 0, 0, 0.87); font-weight: 400;">Email</h3>
                        </p:column>

                        <p:column>
                            <h3 style="color: rgba(0, 0, 0, 0.54); font-weight: 400;"> #{profileManager.user.email}  </h3>
                        </p:column>

                        <p:column>
                            <h3 style="color: rgba(0, 0, 0, 0.87); font-weight: 400;">Phone</h3>
                        </p:column>

                        <p:column>
                            <h3 style="color: rgba(0, 0, 0, 0.54); font-weight: 400;"> #{profileManager.user.mobile}  </h3>
                        </p:column>

                    </p:panelGrid>

                </div>

                <div class="PersonalInfo" >
                    <h3 > Account Info</h3>

                    <p:panelGrid columns="2" styleClass="PersonalIfo">
                        <p:column>
                            <h3 style="color: rgba(0, 0, 0, 0.87); font-weight: 400;">Current BiobankCloud Roles</h3>
                        </p:column>

                        <p:column >

                            <p:dataGrid  value="#{profileManager.currentGroups}" 
                                         var="role" 

                                         emptyMessage="No roles associated with this user."
                                         >
                                <h3 style="color: rgba(0, 0, 0, 0.54); font-weight: 400;">

                                    #{role}
                                </h3>     
                            </p:dataGrid>

                        </p:column>   

                        <p:column>
                            <h3 style="color: rgba(0, 0, 0, 0.87); font-weight: 400;">Last Login</h3>
                        </p:column>

                        <p:column>
                            <h3 style="color: rgba(0, 0, 0, 0.54); font-weight: 400;">
                                #{profileManager.login.loginDate} from #{profileManager.login.ip} with #{profileManager.login.browser}
                            </h3> 
                        </p:column>

                        <p:column>
                            <h3 style="color: rgba(0, 0, 0, 0.87); font-weight: 400;">Last Password Change</h3>
                        </p:column>

                        <p:column>
                            <h3 style="color: rgba(0, 0, 0, 0.54); font-weight: 400;">
                                #{profileManager.user.passwordChanged}
                            </h3>      
                        </p:column>


                    </p:panelGrid>

                </div>

                <h:form >

                    <p:panelMenu>
                        <p:submenu label="Edit Personal Info">
                            <p:menuitem value=""
                                        ajax="false" 
                                        icon="ui-icon-close">
                                <p:panelGrid columns="4"
                                             styleClass="AddressInfo"
                                             >			

                                    <h:outputLabel for="fname" value="First Name" />
                                    <p:inplace  id="fname"  editor="true">

                                        <p:ajax event="save" listener="#{profileManager.updateUserInfo()}" update=":profile_head"/>   
                                        <p:inputText 
                                            value="#{profileManager.user.fname}"
                                            required="true"
                                            requiredMessage="Firs name can not be empty"
                                            >      
                                        </p:inputText>
                                    </p:inplace>


                                    <h:outputLabel for="lname" value="Last Name" />
                                    <p:inplace  id="lname" editor="true">
                                        <p:ajax event="save" listener="#{profileManager.updateUserInfo()}" update=":profile_head"/>   

                                        <p:inputText value="#{profileManager.user.lname}"
                                                     required="true"
                                                     requiredMessage="Last name can not be empty" >
                                        </p:inputText>
                                    </p:inplace>

                                    <h:outputLabel for="title" value="Title" />
                                    <p:inplace  id="title" editor="true">
                                        <p:ajax event="save" listener="#{profileManager.updateUserInfo()}" update=":profile_head"/>   

                                        <p:inputText value="#{profileManager.user.title}">
                                        </p:inputText>
                                    </p:inplace>

                                    <h:outputLabel for="org" value="Organization" />


                                    <p:inplace  id="org"  editor="true">
                                        <p:ajax event="save" listener="#{profileManager.updateUserInfo()}" update=":profile_head"/>   

                                        <p:inputText value="#{profileManager.user.homeOrg}"></p:inputText>
                                    </p:inplace>

                                    <h:outputLabel for="orcid" value="Orcid ID" />


                                    <p:inplace  id="orcid"  editor="true">
                                        <p:ajax event="save" listener="#{profileManager.updateUserInfo()}" update=":profile_head"/>   

                                        <p:inputText value="#{profileManager.user.orcid}"></p:inputText>
                                    </p:inplace>

                                    <h:outputLabel for="mobile" value="Phone" />

                                    <p:inplace  id="mobile"  editor="true">
                                        <p:ajax event="save" listener="#{profileManager.updateUserInfo()}"
                                                update=":profile_head"/>   

                                        <p:inputText  value="#{profileManager.user.mobile}"></p:inputText>
                                    </p:inplace>

                                </p:panelGrid>   


                            </p:menuitem>
                        </p:submenu>

                        <p:submenu label="Edit Address">
                            <p:menuitem value=""
                                        ajax="false" icon="ui-icon-close">

                                <p:panelGrid columns="4" styleClass="AddressInfo">			

                                    <p:outputLabel for="add1" value="C/O"  />					
                                    <p:inplace  id="add1" editor="true">
                                        <p:ajax event="save" listener="#{profileManager.updateAddress()}" update=":profile_head"/>   
                                        <p:inputText value="#{profileManager.address.address1}">
                                        </p:inputText>
                                    </p:inplace>


                                    <p:outputLabel for="add2" value="Street and number"/>
                                    <p:inplace  id="add2" editor="true">
                                        <p:ajax event="save" listener="#{profileManager.updateAddress()}" update=":profile_head"/>   
                                        <p:inputText value="#{profileManager.address.address2}">
                                        </p:inputText>
                                    </p:inplace>

                                    <p:outputLabel for="pc" value="Postal Code"  />
                                    <p:inplace  id="pc" editor="true">
                                        <p:ajax event="save" listener="#{profileManager.updateAddress()}" update=":profile_head"/>   
                                        <p:inputText value="#{profileManager.address.postalcode}">
                                        </p:inputText>
                                    </p:inplace>

                                    <p:outputLabel for="city" value="City"  />
                                    <p:inplace  id="city" editor="true">
                                        <p:inputText       value="#{profileManager.address.city}"   
                                                           >
                                        </p:inputText>
                                    </p:inplace>

                                    <p:outputLabel for="st" value="State"/>
                                    <p:inplace  id="st" editor="true">
                                        <p:inputText       value="#{profileManager.address.state}"   
                                                           >
                                        </p:inputText>
                                    </p:inplace>

                                    <p:outputLabel for="co" value="Country" />
                                    <p:inplace  id="co" editor="true">
                                        <p:inputText       value="#{profileManager.address.country}"   
                                                           >
                                        </p:inputText>
                                    </p:inplace>

                                </p:panelGrid>   
                            </p:menuitem>
                        </p:submenu>


                        <p:submenu label="Security Settings">
                            <p:menuitem value=""
                                        update="messages" ajax="false" icon="ui-icon-close">

                                <div align="left">
                                    <h:panelGroup>

                                        <p:outputLabel for="sec" value="Security Question" 
                                                       />					

                                        <p:commandLink id="sec" 
                                                       value="Change"  
                                                       action="change_sec_question"
                                                       styleClass="command_link">
                                        </p:commandLink>

                                        <br></br>
                                        <p:outputLabel for="password" value="Password" />					
                                        <p:commandLink id ="password" 
                                                       value="Change"
                                                       action="profile_password"
                                                       styleClass="command_link"
                                                       >
                                        </p:commandLink>


                                        <br></br>
                                        <!-- 
                                        <p:outputLabel for="deactivate" value="Close My Account" />					
                                         <p:commandLink id ="deactivate" 
                                                        value="Deactivate My Account"
                                                        action="deactivate_account"
                                                        styleClass="command_link"
                                                        >
                                         </p:commandLink>
         
                                         !-->    
                                    </h:panelGroup>
                                </div>
                            </p:menuitem>
                        </p:submenu>
                    </p:panelMenu>

                </h:form>

                <div align="left" style="padding-top: 20px;">
                    <p:commandLink type="submit" value="Back to main page" action="indexPage"  />
                </div>

            </div>
        </h:body>
    </f:view>
</html>